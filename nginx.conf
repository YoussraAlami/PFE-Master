events {}

http {
    upstream auth_service {
        server authentication_service:8000;
    }

    upstream es_service {
        server elasticsearch_service:9200;
    }
    upstream fastapi {
        server elasticsearch_service:8001;
    }
    upstream es_oracle_service {
        server elasticsearch_service_oracle:8002;
    }
    upstream es_mssql_service {
        server elasticsearch_service_mssql:8003;
    }

    server {
        listen 80;
        

        location /auth/errors/ {
            proxy_pass http://auth_service/errors/;
        }

        location /auth/events/ {
            proxy_pass http://auth_service/events/;
        }

        location /auth/users/ {
            proxy_pass http://auth_service/users/;
        }

        location /auth/user/signup {
            proxy_pass http://auth_service/user/signup;
        }

        location /auth/user/login {
            proxy_pass http://auth_service/user/login;
        }

        location /es/ {
            proxy_pass http://es_service/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
        #  location /es/metrics/ {
        #     proxy_pass http://es_service/metrics;
        #     proxy_set_header Host $host;
        #     proxy_set_header X-Real-IP $remote_addr;
        #     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        #     proxy_set_header X-Forwarded-Proto $scheme;
        # }
        # Ajout des routes "/metrics/" et "/metrics/large/"
        # location /metrics/ {
        #     proxy_pass http://localhost:8001/metrics/;
        # }

        # location /es/metrics/large/ {
        #     proxy_pass http://localhost:8001/metrics/large/;
        # }

        # location /es/metrics/ {
        #     proxy_pass http://es_service/metrics/;
        # }
        ##############MYSQL##################
        location /metrics {
            proxy_pass http://fastapi/metrics;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
        location /metrics/large {
            proxy_pass http://fastapi/metrics/large;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
        location /mysql/status {
            proxy_pass http://fastapi/mysql/status/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
        #/mysql/errors
        location /mysql/errors {
            proxy_pass http://fastapi/mysql/errors;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
        # location /metrics {
        #     proxy_pass http://localhost:8001/metrics;
        #     proxy_set_header Host $host;
        #     proxy_set_header X-Real-IP $remote_addr;
        #     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        #     proxy_set_header X-Forwarded-Proto $scheme;
        # }

        # location / {
        #     proxy_pass http://localhost:8001;
        #     proxy_set_header Host $host;
        #     proxy_set_header X-Real-IP $remote_addr;
        #     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        #     proxy_set_header X-Forwarded-Proto $scheme;
        # }
         ##############Oracle##################
        location /metrics/oracle/all {
            proxy_pass http://es_oracle_service/metrics/oracle/all;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
         ##############MSSQL##################
        location /metrics/mssql/all {
            proxy_pass http://es_mssql_service/metrics/mssql/all;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
        location /metrics/mssql/Total_server_memory {
            proxy_pass http://es_mssql_service/metrics/mssql/Total_server_memory;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
        location /metrics/mssql/DB_state_test1 {
            proxy_pass http://es_mssql_service/metrics/mssql/DB_state_test1;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
        location /metrics/mssql/DB_state_test2 {
            proxy_pass http://es_mssql_service/metrics/mssql/DB_state_test2;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
        #/mssql/errors
        location /mssql/errors {
            proxy_pass http://es_mssql_service/mssql/errors;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
         ##############ORRACLE##################
        location /metrics/oracle/pga/global_memory_bound {
            proxy_pass http://es_oracle_service/metrics/oracle/pga/global_memory_bound;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

        # location /metrics/oracle/pga/global_memory_bound {
        #     proxy_pass http://es_oracle_service/metrics/oracle/pga/global_memory_bound;
        #     proxy_set_header Host $host;
        #     proxy_set_header X-Real-IP $remote_addr;
        #     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        #     proxy_set_header X-Forwarded-Proto $scheme;
        # }
        location /metrics/oracle/pga/total_allocated {
            proxy_pass http://es_oracle_service/metrics/oracle/pga/total_allocated;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
        location /metrics/oracle/pga/total_freeable {
            proxy_pass http://es_oracle_service/metrics/oracle/pga/total_freeable;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
        location /metrics/oracle/pga/total_inuse {
            proxy_pass http://es_oracle_service/metrics/oracle/pga/total_inuse;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
        #SGA
        location /metrics/oracle/sga/buffer_cache{
            proxy_pass http://es_oracle_service/metrics/oracle/sga/buffer_cache;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
        location /metrics/oracle/sga/fixed {
            proxy_pass http://es_oracle_service/metrics/oracle/sga/fixed;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
        location /metrics/oracle/sga/log_buffer {
            proxy_pass http://es_oracle_service/metrics/oracle/sga/log_buffer;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
        
        location /metrics/oracle/sga/shared_pool {
            proxy_pass http://es_oracle_service/metrics/oracle/sga/shared_pool;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
        #TABLESPACES
        #SYSAUX 
        location /metrics/oracle/tbs/free_SYSAUX {
            proxy_pass http://es_oracle_service/metrics/oracle/tbs/free_SYSAUX;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
        location /metrics/oracle/tbs/allocated_SYSAUX {
            proxy_pass http://es_oracle_service/metrics/oracle/tbs/allocated_SYSAUX;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
        location /metrics/oracle/tbs/used_SYSAUX {
            proxy_pass http://es_oracle_service/metrics/oracle/tbs/used_SYSAUX;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
        #SYSTEM
        location /metrics/oracle/tbs/free_SYSTEM {
            proxy_pass http://es_oracle_service/metrics/oracle/tbs/free_SYSTEM;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
         location /metrics/oracle/tbs/allocated_SYSTEM {
            proxy_pass http://es_oracle_service/metrics/oracle/tbs/allocated_SYSTEM;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
        location /metrics/oracle/tbs/used_SYSTEM {
            proxy_pass http://es_oracle_service/metrics/oracle/tbs/used_SYSTEM;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
        #TEMP
        location /metrics/oracle/tbs/free_TEMP {
            proxy_pass http://es_oracle_service/metrics/oracle/tbs/free_TEMP;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
         location /metrics/oracle/tbs/allocated_TEMP {
            proxy_pass http://es_oracle_service/metrics/oracle/tbs/allocated_TEMP;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
        location /metrics/oracle/tbs/used_TEMP {
            proxy_pass http://es_oracle_service/metrics/oracle/tbs/used_TEMP;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
        #UNDOTBS1
        location /metrics/oracle/tbs/free_UNDOTBS1 {
            proxy_pass http://es_oracle_service/metrics/oracle/tbs/free_UNDOTBS1;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
        location /metrics/oracle/tbs/allocated_UNDOTBS1 {
            proxy_pass http://es_oracle_service/metrics/oracle/tbs/allocated_UNDOTBS1;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
        location /metrics/oracle/tbs/used_UNDOTBS1 {
            proxy_pass http://es_oracle_service/metrics/oracle/tbs/used_UNDOTBS1;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
        #USERS
        location /metrics/oracle/tbs/free_USERS {
            proxy_pass http://es_oracle_service/metrics/oracle/tbs/free_USERS;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
        location /metrics/oracle/tbs/allocated_USERS {
            proxy_pass http://es_oracle_service/metrics/oracle/tbs/allocated_USERS;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
        location /metrics/oracle/tbs/used_USERS {
            proxy_pass http://es_oracle_service/metrics/oracle/tbs/used_USERS;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
        #Instance Status
        location /metrics/oracle/instance_status {
            proxy_pass http://es_oracle_service/metrics/oracle/instance_status;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
        #LOCK RATE
        location /metrics/oracle/lock_rate {
            proxy_pass http://es_oracle_service/metrics/oracle/lock_rate;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
        #Archiver State
        location /metrics/oracle/archiver_state {
            proxy_pass http://es_oracle_service/metrics/oracle/archiver_state;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
        #oracle/errors/
        location /oracle/errors {
            proxy_pass http://es_oracle_service/oracle/errors;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

    }
}
